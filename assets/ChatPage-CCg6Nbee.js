import{h as H,c as n,a as r,f as b,b as t,t as h,n as E,r as v,o as K,s as O,g as y,i as U,x as W,F as G,d as J,j as Q,v as X,y as Y,z as q,u as Z,k as ee,p as te}from"./index-vt05okdP.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";const se={key:0,class:"avatar-container"},ae=["src"],re={key:1,class:"bubble-avatar-placeholder"},ne={class:"chat-bubble"},ie={class:"message-text"},oe={class:"message-time"},le={__name:"ChatBubble",props:{message:{type:Object,required:!0},isSender:{type:Boolean,required:!0},riderAvatar:{type:String,default:""},riderNameInitial:{type:String,default:""}},setup(i){const c=i,g=H(()=>c.message.timestamp?new Date(c.message.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1}):"");return(s,o)=>(r(),n("div",{class:E(["chat-bubble-wrapper",{sender:i.isSender,receiver:!i.isSender}])},[i.isSender?b("",!0):(r(),n("div",se,[i.riderAvatar?(r(),n("img",{key:0,src:i.riderAvatar,alt:"Rider Avatar",class:"bubble-avatar"},null,8,ae)):i.riderNameInitial?(r(),n("div",re,h(i.riderNameInitial),1)):b("",!0)])),t("div",ne,[t("p",ie,h(i.message.text),1),t("span",oe,h(g.value),1)])],2))}},de=P(le,[["__scopeId","data-v-4fb7b57d"]]),ue={class:"chat-page"},ce={class:"chat-header"},me=["src"],ve={key:1,class:"rider-avatar-placeholder-header"},he={class:"rider-name-header"},ge={key:0,class:"status-message loading"},pe={key:1,class:"status-message error"},we={key:2,class:"status-message empty"},fe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},ke={class:"chat-input-area"},ye=["disabled"],be={__name:"ChatPage",props:{chatId:{type:String,required:!0}},setup(i){ee();const c=Z(),g=i,s=v(null),o=v([]),d=v(""),f=v(!0),p=v(null),_=["好的，我马上到！","请稍等，大约5分钟后到达","我已经在路上了","请问具体在哪个位置？","感谢您的耐心等待","我找不到具体位置，能发个定位吗？"],x=async a=>{f.value=!0,s.value=null,o.value=[];try{const e=await fetch("/data/messages.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const u=(await e.json())[a];u?(s.value={id:a,rider:u.rider},o.value=u.messages.map(m=>({...m,timestamp:new Date(m.timestamp)})),o.value.length===0&&V()):console.error(`Chat with id ${a} not found in messages.json`)}catch(e){console.error("Failed to fetch chat details:",e)}finally{f.value=!1,await q(),k()}},V=()=>{const a={id:`msg_${Date.now()}`,text:"您好，我是您的骑手，请告诉我您的具体位置",sender:"rider",timestamp:new Date};o.value.push(a)},C=()=>{if(!d.value.trim())return;const a={id:`msg_${Date.now()}`,text:d.value,sender:"user",timestamp:new Date};o.value.push(a),d.value="",k(),L()},L=()=>{const a=1e3+Math.random()*2e3;setTimeout(()=>{const e=Math.floor(Math.random()*_.length),w={id:`msg_${Date.now()}`,text:_[e],sender:"rider",timestamp:new Date};o.value.push(w),k()},a)},k=()=>{q(()=>{p.value&&(p.value.scrollTop=p.value.scrollHeight)})},F=()=>{c.back()},z=()=>{var a,e;(e=(a=s.value)==null?void 0:a.rider)!=null&&e.id&&c.push({name:"rider-profile",params:{riderId:s.value.rider.id}})};return K(()=>{x(g.chatId)}),O(()=>g.chatId,a=>{a&&x(a)}),(a,e)=>{var u,m,D,B,I,R,$,T;const w=W("message-square");return r(),n("div",ue,[t("header",ce,[t("button",{onClick:F,class:"back-button","aria-label":"返回"},e[1]||(e[1]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("polyline",{points:"15 18 9 12 15 6"})],-1)])),t("div",{class:E(["rider-info",{clickable:(m=(u=s.value)==null?void 0:u.rider)==null?void 0:m.id}]),onClick:z},[(B=(D=s.value)==null?void 0:D.rider)!=null&&B.avatar?(r(),n("img",{key:0,src:s.value.rider.avatar,alt:"Rider Avatar",class:"rider-avatar-header"},null,8,me)):(I=s.value)!=null&&I.rider?(r(),n("div",ve,h(((R=s.value.rider.name)==null?void 0:R.charAt(0))||"R"),1)):b("",!0),t("h2",he,h(((T=($=s.value)==null?void 0:$.rider)==null?void 0:T.name)||"加载中..."),1)],2),e[2]||(e[2]=t("div",{class:"header-actions-placeholder"},null,-1))]),f.value?(r(),n("div",ge,e[3]||(e[3]=[t("div",{class:"spinner"},null,-1),y(" 加载聊天记录... ")]))):!s.value||!o.value.length&&!s.value.rider?(r(),n("div",pe,e[4]||(e[4]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("circle",{cx:"12",cy:"12",r:"10"}),t("line",{x1:"12",y1:"8",x2:"12",y2:"12"}),t("line",{x1:"12",y1:"16",x2:"12.01",y2:"16"})],-1),y(" 无法加载聊天信息。 ")]))):o.value.length===0&&s.value.rider?(r(),n("div",we,[(r(),n("svg",fe,[U(w)])),e[5]||(e[5]=y(" 还没有消息，开始聊天吧！ "))])):(r(),n("div",{key:3,class:"messages-container",ref_key:"messagesContainerRef",ref:p},[(r(!0),n(G,null,J(o.value,l=>{var S,j,M,A,N;return r(),te(de,{key:l.id,message:l,"is-sender":l.sender==="user","rider-avatar":l.sender==="rider"?(j=(S=s.value)==null?void 0:S.rider)==null?void 0:j.avatar:void 0,"rider-name-initial":l.sender==="rider"?(N=(A=(M=s.value)==null?void 0:M.rider)==null?void 0:A.name)==null?void 0:N.charAt(0):void 0},null,8,["message","is-sender","rider-avatar","rider-name-initial"])}),128))],512)),t("footer",ke,[Q(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=l=>d.value=l),placeholder:"输入消息...",onKeyup:Y(C,["enter"]),class:"message-input"},null,544),[[X,d.value]]),t("button",{onClick:C,disabled:!d.value.trim(),class:"send-button","aria-label":"发送"},e[6]||(e[6]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[t("line",{x1:"22",y1:"2",x2:"11",y2:"13"}),t("polygon",{points:"22 2 15 22 11 13 2 9 22 2"})],-1)]),8,ye)])])}}},Ce=P(be,[["__scopeId","data-v-449628f9"]]);export{Ce as default};
